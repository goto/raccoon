"use strict";(self.webpackChunkfirehose=self.webpackChunkfirehose||[]).push([[729],{3905:function(e,t,n){n.d(t,{Zo:function(){return s},kt:function(){return f}});var r=n(7294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function c(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var l=r.createContext({}),u=function(e){var t=r.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):a(a({},t),e)),n},s=function(e){var t=u(e.components);return r.createElement(l.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},h=r.forwardRef((function(e,t){var n=e.components,o=e.mdxType,i=e.originalType,l=e.parentName,s=c(e,["components","mdxType","originalType","parentName"]),h=u(n),f=o,d=h["".concat(l,".").concat(f)]||h[f]||p[f]||i;return n?r.createElement(d,a(a({ref:t},s),{},{components:n})):r.createElement(d,a({ref:t},s))}));function f(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var i=n.length,a=new Array(i);a[0]=h;var c={};for(var l in t)hasOwnProperty.call(t,l)&&(c[l]=t[l]);c.originalType=e,c.mdxType="string"==typeof e?e:o,a[1]=c;for(var u=2;u<i;u++)a[u]=n[u];return r.createElement.apply(null,a)}return r.createElement.apply(null,n)}h.displayName="MDXCreateElement"},8261:function(e,t,n){n.r(t),n.d(t,{assets:function(){return s},contentTitle:function(){return l},default:function(){return f},frontMatter:function(){return c},metadata:function(){return u},toc:function(){return p}});var r=n(7462),o=n(3366),i=(n(7294),n(3905)),a=["components"],c={},l="Troubleshooting",u={unversionedId:"guides/troubleshooting",id:"guides/troubleshooting",title:"Troubleshooting",description:"Scale Up Racoon",source:"@site/docs/guides/troubleshooting.md",sourceDirName:"guides",slug:"/guides/troubleshooting",permalink:"/raccoon/guides/troubleshooting",draft:!1,editUrl:"https://github.com/odpf/raccoon/edit/master/docs/docs/guides/troubleshooting.md",tags:[],version:"current",frontMatter:{},sidebar:"docsSidebar",previous:{title:"Monitoring",permalink:"/raccoon/guides/monitoring"},next:{title:"Architecture",permalink:"/raccoon/concepts/architecture"}},s={},p=[{value:"Scale Up Racoon",id:"scale-up-racoon",level:2},{value:"Server",id:"server",level:3},{value:"Worker",id:"worker",level:3},{value:"Publisher",id:"publisher",level:3},{value:"Backpressure",id:"backpressure",level:2}],h={toc:p};function f(e){var t=e.components,n=(0,o.Z)(e,a);return(0,i.kt)("wrapper",(0,r.Z)({},h,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"troubleshooting"},"Troubleshooting"),(0,i.kt)("h2",{id:"scale-up-racoon"},"Scale Up Racoon"),(0,i.kt)("p",null,"Internally, Raccoon has 3 main components that affect the capacity. The server, worker, and publisher. Each component has configurations that can be tune if necessary. Since those 3 components are forming a pipe, you need to make sure none of the components become a bottleneck."),(0,i.kt)("p",null,"To know the right configuration, you need to simulate with similar throughput as production. You can tune the configuration accordingly."),(0,i.kt)("p",null,"Following are details of what you can tune."),(0,i.kt)("h3",{id:"server"},"Server"),(0,i.kt)("p",null,"Raccoon is using WebSocket as a communication protocol from client to server. Websocket requires maintaining long-running connections. Each connection costs the OS an open file descriptor. When you reach the limit of the configured open file descriptor, the server won't be able to accept a new connection. By default, OS limit the number of the open file descriptor. You can look up how to increase the max open file descriptor. On Unix, you can do ",(0,i.kt)("inlineCode",{parentName:"p"},"ulimit -n")," to check max open file descriptor and ",(0,i.kt)("inlineCode",{parentName:"p"},"ulimit -n <number>")," to set a new limit."),(0,i.kt)("p",null,"Apart from OS configuration, there are configurations you can tune on Raccoon:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://odpf.gitbook.io/raccoon/reference/configurations#server_websocket_max_conn"},"SERVER","_","WEBSOCKET","_","MAX","_","CONN")," To limit Raccoon resource utilization, we enforce a limit on WebSocket connection. The default value is 30000; adjust it if necessary.")),(0,i.kt)("h3",{id:"worker"},"Worker"),(0,i.kt)("p",null,"After the request is deserialized, the server puts the events on the buffer channel. The worker process events from the channel and publish them to Kafka. You can think of the worker and the channel as a buffer in case the publisher slows down temporarily."),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://odpf.gitbook.io/raccoon/reference/configurations#worker_buffer_channel_size"},"WORKER","_","BUFFER","_","CHANNEL","_","SIZE")," Buffer before the events get processed. The more the size, the longer it can tolerate a temporary spike or slow down."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://odpf.gitbook.io/raccoon/reference/configurations#worker_pool_size"},"WORKER","_","POOL","_","SIZE")," The worker will call the publisher client and wait synchronously. Increase this according to the throughput.")),(0,i.kt)("h3",{id:"publisher"},"Publisher"),(0,i.kt)("p",null,"Currently, Raccoon is using ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/confluentinc/confluent-kafka-go"},"Librd Kafka client Go wrapper")," as publisher client. There is plenty of guides out there to tune Kafka producer. Here are some configurations you can tune."),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://github.com/edenhill/librdkafka/blob/master/CONFIGURATION.md"},"PUBLISHER","_","KAFKA","_","CLIENT","_","BATCH","_","NUM","_","MESSAGES")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://odpf.gitbook.io/raccoon/reference/configurations#publisher_kafka_client_acks"},"KAFKA","_","CLIENT","_","ACKS")),(0,i.kt)("li",{parentName:"ul"},"KAFKA","_","CLIENT","_","LINGER","_","MS"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://odpf.gitbook.io/raccoon/reference/configurations#publisher_kafka_client_"},"PUBLISHER",(0,i.kt)("em",{parentName:"a"},"KAFKA","_","CLIENT"),"*")," You can put any ",(0,i.kt)("a",{parentName:"li",href:"https://github.com/edenhill/librdkafka/blob/master/CONFIGURATION.md"},"librd kafka configuration")," by replacing ","*"," and change the delimiter to underscore.")),(0,i.kt)("h2",{id:"backpressure"},"Backpressure"),(0,i.kt)("p",null,"You might see the ",(0,i.kt)("inlineCode",{parentName:"p"},"event_processing_duration_milliseconds")," keeps on increasing and ",(0,i.kt)("inlineCode",{parentName:"p"},"batch_idle_in_channel_milliseconds")," is in constant high value. In that case, Raccoon might get backpressure from the publisher. If that happens, you can check the publisher, or you need to tune the publisher configuration on Raccoon."))}f.isMDXComponent=!0}}]);